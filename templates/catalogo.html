{% load static %}

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Catálogo</title>
</head>
<body>
<h1>Catálogo de productos</h1>

<form method="get">
    <input type="text" name="q" placeholder="Buscar..." value="{{ q|default_if_none:'' }}">

    <select name="categoria">
        <option value="">Todas las categorías</option>
        {% for cat in categorias %}
            <option value="{{ cat.id }}" {% if cat.id|stringformat:"s" == categoria_seleccionada %}selected{% endif %}>
                {{ cat.nombre }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Filtrar</button>
</form>

<hr>

<div style="display:flex; flex-wrap:wrap; gap: 20px;">
    {% for p in productos %}
        <div style="border:1px solid #ccc; padding:10px; width:200px;">
            <a href="{% url 'detalle_producto' p.id %}">
                {% with img=p.imagenes.first %}
                    {% if img %}
                        <img src="{{ img.imagen.url }}" alt="{{ p.nombre }}" style="width:100%; height:auto;">
                    {% else %}
                        <div style="width:100%; height:150px; background:#eee; display:flex; align-items:center; justify-content:center;">
                            Sin imagen
                        </div>
                    {% endif %}
                {% endwith %}
                <h3>{{ p.nombre }}</h3>
            </a>
            <p>${{ p.precio }}</p>
        </div>
    {% empty %}
        <p>No hay productos.</p>
    {% endfor %}
</div>

</body>
</html>
