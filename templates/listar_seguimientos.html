{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Seguimientos de productos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

<div class="header">
    <div class="container">
        <a href="{% url 'home' %}" class="header-back">← Volver a la tienda</a>
    </div>
</div>

<div class="container py-4">
    <h2>Seguimientos de productos</h2>

    <!-- Filtros por estado -->
    <div class="card mb-3">
        <div class="card-body">
            <h5>Filtrar por estado:</h5>
            <div class="btn-group" role="group">
                <a href="{% url 'listar_seguimientos' %}" class="btn btn-outline-primary {% if not estado_filtro %}active{% endif %}">Todos</a>
                {% for valor, etiqueta in estados %}
                    <a href="?estado={{ valor }}" class="btn btn-outline-primary {% if estado_filtro == valor %}active{% endif %}">{{ etiqueta }}</a>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Tabla de pedidos -->
    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead class="table-dark">
                <tr>
                    <th>Token</th>
                    <th>Cliente</th>
                    <th>Producto</th>
                    <th>Estado</th>
                    <th>Pago</th>
                    <th>Fecha</th>
                    <th>Acción</th>
                </tr>
            </thead>
            <tbody>
                {% for orden in ordenes %}
                    <tr>
                        <td><strong>{{ orden.token }}</strong></td>
                        <td>{{ orden.cliente_nombre }}</td>
                        <td>{% if orden.producto_referencia %}{{ orden.producto_referencia.nombre }}{% else %}—{% endif %}</td>
                        <td>
                            <span class="badge 
                                {% if orden.estado == 'solicitado' %}bg-warning{% endif %}
                                {% if orden.estado == 'en_proceso' %}bg-info{% endif %}
                                {% if orden.estado == 'completado' %}bg-success{% endif %}
                                {% if orden.estado == 'cancelado' %}bg-danger{% endif %}
                            ">
                                {{ orden.get_estado_display }}
                            </span>
                        </td>
                        <td>
                            <span class="badge {% if orden.estado_pago == 'pagado' %}bg-success{% else %}bg-warning{% endif %}">
                                {{ orden.get_estado_pago_display }}
                            </span>
                        </td>
                        <td>{{ orden.creado|date:"d/m/Y H:i" }}</td>
                        <td>
                            <a href="{% url 'seguimiento_pedido' orden.token %}" class="btn btn-sm btn-primary">Ver</a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="7" class="text-center text-muted">No hay pedidos disponibles.</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    {% if ordenes.has_other_pages %}
        <nav aria-label="Paginación" class="mt-4">
            <ul class="pagination justify-content-center">
                {% if ordenes.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}">« Primera</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ ordenes.previous_page_number }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}">‹ Anterior</a>
                    </li>
                {% endif %}

                {% for num in ordenes.paginator.page_range %}
                    {% if ordenes.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                    {% else %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}">{{ num }}</a>
                        </li>
                    {% endif %}
                {% endfor %}

                {% if ordenes.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ ordenes.next_page_number }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}">Siguiente ›</a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ ordenes.paginator.num_pages }}{% if estado_filtro %}&estado={{ estado_filtro }}{% endif %}">Última »</a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>