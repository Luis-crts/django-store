{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Sistema de reportes</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>

<div class="header">
    <div class="container">
        <a href="{% url 'home' %}" class="header-back">← Volver a la tienda</a>
    </div>
</div>

<div class="container py-4">
    <h2>Sistema de reportes</h2>

    <!-- Tarjetas de estadisticas -->
    <div class="row g-4 mb-4">
        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total de pedidos</h5>
                    <h2 class="text-primary">{{ total_pedidos }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Pedidos pagados</h5>
                    <h2 class="text-success">{{ pedidos_pagados }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Pedidos pendientes</h5>
                    <h2 class="text-warning">{{ pedidos_pendientes }}</h2>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total ingresos</h5>
                    <h2 class="text-info">${{ total_ingresos|floatformat:0 }}</h2>
                </div>
            </div>
        </div>
    </div>

    <!-- Producto más pedido -->
    <div class="card">
        <div class="card-header bg-primary text-white">
            <h5 class="mb-0">Producto más pedido (pagado)</h5>
        </div>
        <div class="card-body">
            {% if producto_mas_pedido %}
                <div class="row">
                    <div class="col-md-4">
                        {% if producto_mas_pedido.producto.imagenes.all %}
                            <img src="{{ producto_mas_pedido.producto.imagenes.first.imagen.url }}" 
                                 alt="{{ producto_mas_pedido.producto.nombre }}" 
                                 class="img-fluid rounded" 
                                 style="max-height: 300px; object-fit: cover;">
                        {% else %}
                            <div class="bg-light p-5 rounded text-center">
                                <p class="text-muted">Sin imagen</p>
                            </div>
                        {% endif %}
                    </div>
                    <div class="col-md-8">
                        <h3>{{ producto_mas_pedido.producto.nombre }}</h3>
                        <p class="text-muted">{{ producto_mas_pedido.producto.descripcion }}</p>
                        <p>
                            <strong>Precio:</strong> ${{ producto_mas_pedido.producto.precio }}
                        </p>
                        <p>
                            <strong>Cantidad de pedidos pagados:</strong> 
                            <span class="badge bg-success">{{ producto_mas_pedido.cantidad_pedidos }}</span>
                        </p>
                        <a href="{% url 'detalle_producto' producto_mas_pedido.producto.pk %}" 
                           class="btn btn-primary">Ver producto</a>
                    </div>
                </div>
            {% else %}
                <p class="text-muted">Aún no hay pedidos pagados.</p>
            {% endif %}
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>