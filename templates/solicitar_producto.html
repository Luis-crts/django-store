{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Solicitar producto</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
<div class="container py-4">
    <a href="{% url 'home' %}" class="back-link">&larr; Volver</a>

    <h2>Solicitud de pedido</h2>

    {% if error %}
        <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <form method="POST" enctype="multipart/form-data" class="mt-3">
        {% csrf_token %}
        <div class="mb-3">
            <label class="form-label">Nombre del cliente</label>
            <input type="text" name="nombre" class="form-control" value="{{ initial.nombre }}">
        </div>

        <div class="mb-3">
            <label class="form-label">Correo electrónico <span class="text-danger">*</span></label>
            <input type="email" name="email" class="form-control" required value="{{ initial.email }}">
        </div>

        <div class="row g-2">
            <div class="col-md-5 mb-3">
                <label class="form-label">Medio de contacto</label>
                <select name="contact_method" id="contact_method" class="form-select">
                    <option{% if initial.contact_method == "Facebook" %} selected{% endif %}>Facebook</option>
                    <option{% if initial.contact_method == "Instagram" %} selected{% endif %}>Instagram</option>
                    <option{% if initial.contact_method == "WhatsApp" %} selected{% endif %}>WhatsApp</option>
                    <option{% if initial.contact_method == "Presencial" %} selected{% endif %}>Presencial</option>
                    <option{% if initial.contact_method == "Sitio Web" %} selected{% endif %}>Sitio Web</option>
                    <option{% if initial.contact_method == "Otros" %} selected{% endif %}>Otros</option>
                </select>
            </div>

            <div class="col-md-7 mb-3">
                <label class="form-label" id="contact_value_label">Teléfono / cuenta</label>
                <input type="text" name="contact_value" id="contact_value" class="form-control" value="{{ initial.contact_value }}" placeholder="ej: +569 1234 5678 o usuario">
            </div>
        </div>

        {% if producto %}
            <div class="mb-3">
                <label class="form-label">Producto de referencia</label>
                <input type="text" class="form-control" value="{{ producto.nombre }}" readonly>
            </div>
        {% endif %}

        <div class="mb-3">
            <label class="form-label">Imágenes de referencia (opcional)</label>
            <input type="file" name="imagenes" class="form-control" accept="image/*" multiple>
        </div>

        <div class="mb-3">
            <label class="form-label">Descripción de lo solicitado</label>
            <textarea name="descripcion" class="form-control" rows="4">{{ initial.descripcion }}</textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">Fecha en que necesita el producto (opcional)</label>
            <input type="date" name="fecha_necesaria" class="form-control" value="{{ initial.fecha_necesaria }}">
        </div>

        <button class="btn btn-success" type="submit">Enviar solicitud</button>
    </form>
</div>

<script>
    // mejorar UX: adaptar label/placeholder según medio de contacto
    (function(){
        const method = document.getElementById('contact_method');
        const val = document.getElementById('contact_value');
        const lbl = document.getElementById('contact_value_label');

        function updatePlaceholder(){
            const m = method.value;
            if (m === 'WhatsApp') {
                lbl.textContent = 'Teléfono / WhatsApp';
                val.placeholder = 'ej: +569 1234 5678';
            } else if (m === 'Facebook' || m === 'Instagram' || m === 'Sitio Web') {
                lbl.textContent = 'Usuario / URL';
                val.placeholder = 'ej: usuario o https://...';
            } else if (m === 'Presencial') {
                lbl.textContent = 'Dirección / Local';
                val.placeholder = 'ej: Dirección o sucursal';
            } else {
                lbl.textContent = 'Contacto (detalle)';
                val.placeholder = 'ej: número, usuario o link';
            }
        }
        method.addEventListener('change', updatePlaceholder);
        updatePlaceholder();
    })();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>